<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>Debug Grist Widget</title>
  <style>
    body {
      font-family: monospace;
      background-color: #f8f8f8;
      padding: 20px;
    }
    .block {
      background: #fff;
      border: 1px solid #ccc;
      padding: 15px;
      margin-bottom: 10px;
      border-radius: 6px;
    }
    .error {
      color: red;
    }
  </style>
</head>
<body>
  <h2>üß™ Grist Widget Debug</h2>
  <div id="summary" class="block">En attente de donn√©es...</div>
  <div id="details" class="block"></div>

  <script>
    window.addEventListener("message", (event) => {
      const grist = event.source;

      grist.onRecords((records) => {
        const lignes = records.records;
        const resume = document.getElementById("summary");
        const details = document.getElementById("details");

        if (!lignes || lignes.length === 0) {
          resume.innerHTML = "‚ö†Ô∏è Aucune ligne re√ßue depuis Grist.";
          return;
        }

        // Affiche le nombre de lignes re√ßues
        resume.innerHTML = `‚úî ${lignes.length} lignes re√ßues.`;

        // Cherche les cl√©s disponibles
        const cles = Object.keys(lignes[0] || {});

        // Affiche les cl√©s et valeurs d'une ligne exemple
        let exemple = lignes[0];
        let contenu = `<strong>Cl√©s disponibles :</strong><br>${cles.join(", ")}<br><br>`;

        contenu += `<strong>Exemple (ligne 1) :</strong><br>`;
        contenu += `Month = <code>${exemple.Month}</code><br>`;
        contenu += `Employee = <code>${exemple.Employee}</code><br>`;
        contenu += `Total = <code>${exemple.Total}</code><br>`;

        // Affichage brut complet
        contenu += `<br><strong>Donn√©es brutes :</strong><pre>${JSON.stringify(exemple, null, 2)}</pre>`;

        details.innerHTML = contenu;
      });
    });
  </script>
</body>
</html>
